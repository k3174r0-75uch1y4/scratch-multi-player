import{g as Ge}from"./index-X4I3mib_.js";function Ve(u,r){for(var e=0;e<r.length;e++){const n=r[e];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in u)){const t=Object.getOwnPropertyDescriptor(n,i);t&&Object.defineProperty(u,i,t.get?t:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}))}var M={exports:{}};/**
 *  StartAudioContext.js
 *  @author Yotam Mann
 *  @license http://opensource.org/licenses/MIT MIT License
 *  @copyright 2016 Yotam Mann
 */var Je=M.exports,ce;function $e(){return ce||(ce=1,(function(u){(function(r,e){u.exports?u.exports=e():r.StartAudioContext=e()})(Je,function(){var r=function(o,f){this._dragged=!1,this._element=o,this._bindedMove=this._moved.bind(this),this._bindedEnd=this._ended.bind(this,f),o.addEventListener("touchstart",this._bindedEnd),o.addEventListener("touchmove",this._bindedMove),o.addEventListener("touchend",this._bindedEnd),o.addEventListener("mouseup",this._bindedEnd)};r.prototype._moved=function(o){this._dragged=!0},r.prototype._ended=function(o){this._dragged||e(o),this._dragged=!1},r.prototype.dispose=function(){this._element.removeEventListener("touchstart",this._bindedEnd),this._element.removeEventListener("touchmove",this._bindedMove),this._element.removeEventListener("touchend",this._bindedEnd),this._element.removeEventListener("mouseup",this._bindedEnd),this._bindedMove=null,this._bindedEnd=null,this._element=null};function e(o){var f=o.createBuffer(1,1,o.sampleRate),g=o.createBufferSource();g.buffer=f,g.connect(o.destination),g.start(0),o.resume&&o.resume()}function n(o){return o.state==="running"}function i(o,f){function g(){n(o)?f():(requestAnimationFrame(g),o.resume&&o.resume())}n(o)?f():g()}function t(o,f,g){if(Array.isArray(o)||NodeList&&o instanceof NodeList)for(var y=0;y<o.length;y++)t(o[y],f,g);else if(typeof o=="string")t(document.querySelectorAll(o),f,g);else if(o.jquery&&typeof o.toArray=="function")t(o.toArray(),f,g);else if(Element&&o instanceof Element){var d=new r(o,g);f.push(d)}}function s(o,f,g){var y=new Promise(function(E){i(o,E)}),d=[];return f||(f=document.body),t(f,d,o),y.then(function(){for(var E=0;E<d.length;E++)d[E].dispose();d=null,g&&g()}),y}return s})})(M)),M.exports}var k,fe;function We(){if(fe)return k;fe=1;const u=$e();return k=function(r){if(typeof document<"u")return u(r)},k}var U,he;function Qe(){if(he)return U;he=1;var u={};return U=function(e){if(typeof window>"u")return null;var n=window.OfflineAudioContext||window.webkitOfflineAudioContext,i=window.AudioContext||window.webkitAudioContext;if(!i)return null;typeof e=="number"&&(e={sampleRate:e});var t=e&&e.sampleRate;if(e&&e.offline)return n?new n(e.channels||2,e.length,t||44100):null;var s=u[t];if(s)return s;try{s=new i(e)}catch{s=new i}return u[s.sampleRate]=u[t]=s,s},U}var T={exports:{}},R={exports:{}},D,le;function Ye(){if(le)return D;le=1;function u(){this._events={}}return u.prototype={on:function(r,e){this._events||(this._events={});var n=this._events;return(n[r]||(n[r]=[])).push(e),this},removeListener:function(r,e){var n=this._events[r]||[],i;for(i=n.length-1;i>=0&&n[i];i--)(n[i]===e||n[i].cb===e)&&n.splice(i,1)},removeAllListeners:function(r){r?this._events[r]&&(this._events[r]=[]):this._events={}},listeners:function(r){return this._events?this._events[r]||[]:[]},emit:function(r){this._events||(this._events={});var e=Array.prototype.slice.call(arguments,1),n,i=this._events[r]||[];for(n=i.length-1;n>=0&&i[n];n--)i[n].apply(this,e);return this},when:function(r,e){return this.once(r,e,!0)},once:function(r,e,n){if(!e)return this;function i(){n||this.removeListener(r,i),e.apply(this,arguments)&&n&&this.removeListener(r,i)}return i.cb=e,this.on(r,i),this}},u.mixin=function(r){var e=u.prototype,n;for(n in e)e.hasOwnProperty(n)&&(r.prototype[n]=e[n])},D=u,D}var B,de;function C(){if(de)return B;de=1;var u=Ye();function r(){}return u.mixin(r),r.prototype.write=function(e,n,i){this.emit("item",e,n,i)},r.prototype.end=function(){this.emit("end"),this.removeAllListeners()},r.prototype.pipe=function(e){var n=this;n.emit("unpipe",e),e.emit("pipe",n);function i(){e.write.apply(e,Array.prototype.slice.call(arguments))}function t(){!e._isStdio&&e.end()}return n.on("item",i),n.on("end",t),n.when("unpipe",function(s){var o=s===e||typeof s>"u";return o&&(n.removeListener("item",i),n.removeListener("end",t),e.emit("unpipe")),o}),e},r.prototype.unpipe=function(e){return this.emit("unpipe",e),this},r.prototype.format=function(e){throw new Error(["Warning: .format() is deprecated in Minilog v2! Use .pipe() instead. For example:","var Minilog = require('minilog');","Minilog","  .pipe(Minilog.backends.console.formatClean)","  .pipe(Minilog.backends.console);"].join(`
`))},r.mixin=function(e){var n=r.prototype,i;for(i in n)n.hasOwnProperty(i)&&(e.prototype[i]=n[i])},B=r,B}var j,pe;function Ke(){if(pe)return j;pe=1;var u=C(),r={debug:1,info:2,warn:3,error:4};function e(){this.enabled=!0,this.defaultResult=!0,this.clear()}u.mixin(e),e.prototype.allow=function(i,t){return this._white.push({n:i,l:r[t]}),this},e.prototype.deny=function(i,t){return this._black.push({n:i,l:r[t]}),this},e.prototype.clear=function(){return this._white=[],this._black=[],this};function n(i,t){return i.n.test?i.n.test(t):i.n==t}return e.prototype.test=function(i,t){var s,o=Math.max(this._white.length,this._black.length);for(s=0;s<o;s++){if(this._white[s]&&n(this._white[s],i)&&r[t]>=this._white[s].l)return!0;if(this._black[s]&&n(this._black[s],i)&&r[t]<=this._black[s].l)return!1}return this.defaultResult},e.prototype.write=function(i,t,s){if(!this.enabled||this.test(i,t))return this.emit("item",i,t,s)},j=e,j}var ge;function He(){return ge||(ge=1,(function(u,r){var e=C(),n=Ke(),i=new e,t=Array.prototype.slice;r=u.exports=function(o){var f=function(){return i.write(o,void 0,t.call(arguments)),f};return f.debug=function(){return i.write(o,"debug",t.call(arguments)),f},f.info=function(){return i.write(o,"info",t.call(arguments)),f},f.warn=function(){return i.write(o,"warn",t.call(arguments)),f},f.error=function(){return i.write(o,"error",t.call(arguments)),f},f.log=f.debug,f.suggest=r.suggest,f.format=i.format,f},r.defaultBackend=r.defaultFormatter=null,r.pipe=function(s){return i.pipe(s)},r.end=r.unpipe=r.disable=function(s){return i.unpipe(s)},r.Transform=e,r.Filter=n,r.suggest=new n,r.enable=function(){return r.defaultFormatter?i.pipe(r.suggest).pipe(r.defaultFormatter).pipe(r.defaultBackend):i.pipe(r.suggest).pipe(r.defaultBackend)}})(R,R.exports)),R.exports}var I,ve;function je(){if(ve)return I;ve=1;var u={black:"#000",red:"#c23621",green:"#25bc26",yellow:"#bbbb00",blue:"#492ee1",magenta:"#d338d3",cyan:"#33bbc8",gray:"#808080",purple:"#708"};function r(e,n){return n?"color: #fff; background: "+u[e]+";":"color: "+u[e]+";"}return I=r,I}var z,me;function Xe(){if(me)return z;me=1;var u=C(),r=je(),e={debug:["cyan"],info:["purple"],warn:["yellow",!0],error:["red",!0]},n=new u;return n.write=function(i,t,s){var o=console.log;console[t]&&console[t].apply&&(o=console[t],o.apply(console,["%c"+i+" %c"+t,r("gray"),r.apply(r,e[t])].concat(s)))},n.pipe=function(){},z=n,z}var F,ye;function Ze(){if(ye)return F;ye=1;var u=C(),r=je(),e={debug:["gray"],info:["purple"],warn:["yellow",!0],error:["red",!0]},n=new u;return n.write=function(i,t,s){var o=console.log;t!="debug"&&console[t]&&(o=console[t]);var f=0;if(t!="info"){for(;f<s.length&&typeof s[f]=="string";f++);o.apply(console,["%c"+i+" "+s.slice(0,f).join(" "),r.apply(r,e[t])].concat(s.slice(f)))}else o.apply(console,["%c"+i,r.apply(r,e[t])].concat(s))},n.pipe=function(){},F=n,F}var G,Ee;function et(){if(Ee)return G;Ee=1;var u=C(),r=/\n+$/,e=new u;return e.write=function(n,i,t){var s=t.length-1;if(!(typeof console>"u"||!console.log)){if(console.log.apply)return console.log.apply(console,[n,i].concat(t));if(JSON&&JSON.stringify){t[s]&&typeof t[s]=="string"&&(t[s]=t[s].replace(r,""));try{for(s=0;s<t.length;s++)t[s]=JSON.stringify(t[s])}catch{}console.log(t.join(" "))}}},e.formatters=["color","minilog"],e.color=Xe(),e.minilog=Ze(),G=e,G}var V,_e;function tt(){if(_e)return V;_e=1;var u=C(),r=[],e=new u;return e.write=function(n,i,t){r.push([n,i,t])},e.get=function(){return r},e.empty=function(){r=[]},V=e,V}var J,we;function nt(){if(we)return J;we=1;var u=C(),r=!1,e=new u;return e.write=function(n,i,t){if(!(typeof window>"u"||typeof JSON>"u"||!JSON.stringify||!JSON.parse))try{r||(r=window.localStorage.minilog?JSON.parse(window.localStorage.minilog):[]),r.push([new Date().toString(),n,i,t]),window.localStorage.minilog=JSON.stringify(r)}catch{}},J=e,J}var $,be;function it(){if(be)return $;be=1;var u=C(),r=new Date().valueOf().toString(36);function e(n){this.url=n.url||"",this.cache=[],this.timer=null,this.interval=n.interval||30*1e3,this.enabled=!0,this.jQuery=window.jQuery,this.extras={}}return u.mixin(e),e.prototype.write=function(n,i,t){this.timer||this.init(),this.cache.push([n,i].concat(t))},e.prototype.init=function(){if(!(!this.enabled||!this.jQuery)){var n=this;this.timer=setTimeout(function(){var i,t=[],s,o=n.url;if(n.cache.length==0)return n.init();for(i=0;i<n.cache.length;i++)try{JSON.stringify(n.cache[i]),t.push(n.cache[i])}catch{}n.jQuery.isEmptyObject(n.extras)?(s=JSON.stringify({logs:t}),o=n.url+"?client_id="+r):s=JSON.stringify(n.jQuery.extend({logs:t},n.extras)),n.jQuery.ajax(o,{type:"POST",cache:!1,processData:!1,data:s,contentType:"application/json",timeout:1e4}).success(function(f,g,y){f.interval&&(n.interval=Math.max(1e3,f.interval))}).error(function(){n.interval=3e4}).always(function(){n.init()}),n.cache=[]},this.interval)}},e.prototype.end=function(){},e.jQueryWait=function(n){if(typeof window<"u"&&(window.jQuery||window.$))return n(window.jQuery||window.$);typeof window<"u"&&setTimeout(function(){e.jQueryWait(n)},200)},$=e,$}var Se;function rt(){return Se||(Se=1,(function(u,r){var e=He(),n=e.enable,i=e.disable,t=typeof navigator<"u"&&/chrome/i.test(navigator.userAgent),s=et();if(e.defaultBackend=t?s.minilog:s,typeof window<"u"){try{e.enable(JSON.parse(window.localStorage.minilogSettings))}catch{}if(window.location&&window.location.search){var o=RegExp("[?&]minilog=([^&]*)").exec(window.location.search);o&&e.enable(decodeURIComponent(o[1]))}}e.enable=function(){n.call(e,!0);try{window.localStorage.minilogSettings=JSON.stringify(!0)}catch{}return this},e.disable=function(){i.call(e);try{delete window.localStorage.minilogSettings}catch{}return this},r=u.exports=e,r.backends={array:tt(),browser:e.defaultBackend,localStorage:nt(),jQuery:it()}})(T,T.exports)),T.exports}var W,Ae;function O(){if(Ae)return W;Ae=1;const u=rt();return u.enable(),W=u("scratch-audioengine"),W}var Q,Le;function st(){if(Le)return Q;Le=1;const u="!#%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return Q=function(){const n=u.length,i=[];for(let t=0;t<20;t++)i[t]=u.charAt(Math.random()*n);return i.join("")},Q}var Y,Pe;function ot(){if(Pe)return Y;Pe=1;class u{constructor(e,n=0,i=e.byteLength,{_uint8View:t=new Uint8Array(e)}={}){this.arrayBuffer=e,this.start=n,this.end=i,this._uint8View=t,this._position=n}extract(e){return new u(this.arrayBuffer,this._position,this._position+e,this)}getLength(){return this.end-this.start}getBytesAvailable(){return this.end-this._position}get position(){return this._position-this.start}set position(e){this._position=e+this.start}readUint8(){const e=this._uint8View[this._position];return this._position+=1,e}readUint8String(e){const n=this._uint8View;let i="";const t=this._position+e;for(let s=this._position;s<t;s++)i+=String.fromCharCode(n[s]);return this._position+=e,i}readInt16(){const e=new Int16Array(this.arrayBuffer,this._position,1)[0];return this._position+=2,e}readUint16(){const e=new Uint16Array(this.arrayBuffer,this._position,1)[0];return this._position+=2,e}readInt32(){let e;return this._position%4===0?e=new Int32Array(this.arrayBuffer,this._position,1)[0]:e=new Int32Array(this.arrayBuffer.slice(this._position,this._position+4))[0],this._position+=4,e}readUint32(){const e=new Uint32Array(this.arrayBuffer,this._position,1)[0];return this._position+=4,e}}return Y=u,Y}var K,Ne;function at(){if(Ne)return K;Ne=1;const u=ot(),r=O(),e=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767],n=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8];let i=null;const t=function(){if(i===null){const o=e.length,f=n.length;i=new Array(o*f).fill(0);let g=0;for(let y=0;y<o;y++)for(let d=0;d<f;d++){const E=e[y];let b=0;d&4&&(b+=E),d&2&&(b+=E>>1),d&1&&(b+=E>>2),b+=E>>3,i[g++]=d&8?-b:b}}return i};class s{constructor(f){this.audioContext=f}static get STEP_TABLE(){return e}static get INDEX_TABLE(){return n}decode(f){return new Promise((g,y)=>{const d=new u(f);d.readUint8String(4)!=="RIFF"&&(r.warn("incorrect adpcm wav header"),y(new Error("incorrect adpcm wav header")));const b=d.readInt32();b+8!==f.byteLength&&r.warn(`adpcm wav length in header: ${b} is incorrect`),d.readUint8String(4)!=="WAVE"&&(r.warn("incorrect adpcm wav header"),y(new Error("incorrect adpcm wav header")));const m=this.extractChunk("fmt ",d);this.encoding=m.readUint16(),this.channels=m.readUint16(),this.samplesPerSecond=m.readUint32(),this.bytesPerSecond=m.readUint32(),this.blockAlignment=m.readUint16(),this.bitsPerSample=m.readUint16(),m.position+=2,this.samplesPerBlock=m.readUint16(),this.adpcmBlockSize=(this.samplesPerBlock-1)/2+4;const S=this.extractChunk("data",d),L=this.numberOfSamples(S,this.adpcmBlockSize),P=this.audioContext.createBuffer(1,L,this.samplesPerSecond);this.imaDecompress(S,this.adpcmBlockSize,P.getChannelData(0)),g(P)})}extractChunk(f,g){for(g.position=12;g.position<g.getLength()-8;){const y=g.readUint8String(4),d=g.readInt32();if(y===f)return g.extract(d);g.position+=d}}numberOfSamples(f,g){if(!f)return 0;f.position=0;const y=f.getBytesAvailable(),E=(y/g|0)*(2*(g-4))+1,b=Math.max(y%g-4,0)*2,_=Math.min(y%g,1);return E+b+_}imaDecompress(f,g,y){let d,E,b,_=0,m=-1;if(!f)return;f.position=0;const S=y.length,L=(g-4)*2,P=t();let A=0;for(;A<S;){d=f.readInt16(),_=f.readUint8(),f.position++,_>88&&(_=88),y[A++]=d/32768;const c=Math.min(L,S-A),a=A;for(;A-a<c;)m=f.readUint8(),E=m&15,b=P[_*16+E],_+=n[E],_>88?_=88:_<0&&(_=0),d+=b,d>32767?d=32767:d<-32768&&(d=-32768),y[A++]=d/32768,E=m>>4&15,b=P[_*16+E],_+=n[E],_>88?_=88:_<0&&(_=0),d+=b,d>32767?d=32767:d<-32768&&(d=-32768),y[A++]=d/32768}}}return K=s,K}var H,Ce;function ut(){if(Ce)return H;Ce=1;const u=O();class r{constructor(n){this.audioContext=n,this.connectingToMic=!1,this.mic=null}getLoudness(){if(!this.mic&&!this.connectingToMic&&(this.connectingToMic=!0,navigator.mediaDevices.getUserMedia({audio:!0}).then(n=>{this.audioStream=n,this.mic=this.audioContext.createMediaStreamSource(n),this.analyser=this.audioContext.createAnalyser(),this.mic.connect(this.analyser),this.micDataArray=new Float32Array(this.analyser.fftSize)}).catch(n=>{u.warn(n)})),this.mic&&this.audioStream.active){this.analyser.getFloatTimeDomainData(this.micDataArray);let n=0;for(let t=0;t<this.micDataArray.length;t++)n+=Math.pow(this.micDataArray[t],2);let i=Math.sqrt(n/this.micDataArray.length);return this._lastValue&&(i=Math.max(i,this._lastValue*.6)),this._lastValue=i,i*=1.63,i=Math.sqrt(i),i=Math.round(i*100),i=Math.min(i,100),i}return-1}}return H=r,H}var q={exports:{}},xe;function ct(){if(xe)return q.exports;xe=1;var u=typeof Reflect=="object"?Reflect:null,r=u&&typeof u.apply=="function"?u.apply:function(a,h,l){return Function.prototype.apply.call(a,h,l)},e;u&&typeof u.ownKeys=="function"?e=u.ownKeys:Object.getOwnPropertySymbols?e=function(a){return Object.getOwnPropertyNames(a).concat(Object.getOwnPropertySymbols(a))}:e=function(a){return Object.getOwnPropertyNames(a)};function n(c){console&&console.warn&&console.warn(c)}var i=Number.isNaN||function(a){return a!==a};function t(){t.init.call(this)}q.exports=t,q.exports.once=L,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._eventsCount=0,t.prototype._maxListeners=void 0;var s=10;function o(c){if(typeof c!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof c)}Object.defineProperty(t,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(c){if(typeof c!="number"||c<0||i(c))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+c+".");s=c}}),t.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},t.prototype.setMaxListeners=function(a){if(typeof a!="number"||a<0||i(a))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+a+".");return this._maxListeners=a,this};function f(c){return c._maxListeners===void 0?t.defaultMaxListeners:c._maxListeners}t.prototype.getMaxListeners=function(){return f(this)},t.prototype.emit=function(a){for(var h=[],l=1;l<arguments.length;l++)h.push(arguments[l]);var p=a==="error",w=this._events;if(w!==void 0)p=p&&w.error===void 0;else if(!p)return!1;if(p){var v;if(h.length>0&&(v=h[0]),v instanceof Error)throw v;var N=new Error("Unhandled error."+(v?" ("+v.message+")":""));throw N.context=v,N}var x=w[a];if(x===void 0)return!1;if(typeof x=="function")r(x,this,h);else for(var ue=x.length,Fe=_(x,ue),l=0;l<ue;++l)r(Fe[l],this,h);return!0};function g(c,a,h,l){var p,w,v;if(o(h),w=c._events,w===void 0?(w=c._events=Object.create(null),c._eventsCount=0):(w.newListener!==void 0&&(c.emit("newListener",a,h.listener?h.listener:h),w=c._events),v=w[a]),v===void 0)v=w[a]=h,++c._eventsCount;else if(typeof v=="function"?v=w[a]=l?[h,v]:[v,h]:l?v.unshift(h):v.push(h),p=f(c),p>0&&v.length>p&&!v.warned){v.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+v.length+" "+String(a)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.emitter=c,N.type=a,N.count=v.length,n(N)}return c}t.prototype.addListener=function(a,h){return g(this,a,h,!1)},t.prototype.on=t.prototype.addListener,t.prototype.prependListener=function(a,h){return g(this,a,h,!0)};function y(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(c,a,h){var l={fired:!1,wrapFn:void 0,target:c,type:a,listener:h},p=y.bind(l);return p.listener=h,l.wrapFn=p,p}t.prototype.once=function(a,h){return o(h),this.on(a,d(this,a,h)),this},t.prototype.prependOnceListener=function(a,h){return o(h),this.prependListener(a,d(this,a,h)),this},t.prototype.removeListener=function(a,h){var l,p,w,v,N;if(o(h),p=this._events,p===void 0)return this;if(l=p[a],l===void 0)return this;if(l===h||l.listener===h)--this._eventsCount===0?this._events=Object.create(null):(delete p[a],p.removeListener&&this.emit("removeListener",a,l.listener||h));else if(typeof l!="function"){for(w=-1,v=l.length-1;v>=0;v--)if(l[v]===h||l[v].listener===h){N=l[v].listener,w=v;break}if(w<0)return this;w===0?l.shift():m(l,w),l.length===1&&(p[a]=l[0]),p.removeListener!==void 0&&this.emit("removeListener",a,N||h)}return this},t.prototype.off=t.prototype.removeListener,t.prototype.removeAllListeners=function(a){var h,l,p;if(l=this._events,l===void 0)return this;if(l.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):l[a]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete l[a]),this;if(arguments.length===0){var w=Object.keys(l),v;for(p=0;p<w.length;++p)v=w[p],v!=="removeListener"&&this.removeAllListeners(v);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(h=l[a],typeof h=="function")this.removeListener(a,h);else if(h!==void 0)for(p=h.length-1;p>=0;p--)this.removeListener(a,h[p]);return this};function E(c,a,h){var l=c._events;if(l===void 0)return[];var p=l[a];return p===void 0?[]:typeof p=="function"?h?[p.listener||p]:[p]:h?S(p):_(p,p.length)}t.prototype.listeners=function(a){return E(this,a,!0)},t.prototype.rawListeners=function(a){return E(this,a,!1)},t.listenerCount=function(c,a){return typeof c.listenerCount=="function"?c.listenerCount(a):b.call(c,a)},t.prototype.listenerCount=b;function b(c){var a=this._events;if(a!==void 0){var h=a[c];if(typeof h=="function")return 1;if(h!==void 0)return h.length}return 0}t.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};function _(c,a){for(var h=new Array(a),l=0;l<a;++l)h[l]=c[l];return h}function m(c,a){for(;a+1<c.length;a++)c[a]=c[a+1];c.pop()}function S(c){for(var a=new Array(c.length),h=0;h<a.length;++h)a[h]=c[h].listener||c[h];return a}function L(c,a){return new Promise(function(h,l){function p(v){c.removeListener(a,w),l(v)}function w(){typeof c.removeListener=="function"&&c.removeListener("error",p),h([].slice.call(arguments))}A(c,a,w,{once:!0}),a!=="error"&&P(c,p,{once:!0})})}function P(c,a,h){typeof c.on=="function"&&A(c,"error",a,h)}function A(c,a,h,l){if(typeof c.on=="function")l.once?c.once(a,h):c.on(a,h);else if(typeof c.addEventListener=="function")c.addEventListener(a,function p(w){l.once&&c.removeEventListener(a,p),h(w)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof c)}return q.exports}var X,Te;function ae(){if(Te)return X;Te=1;class u{constructor(e,n,i){this.audioEngine=e,this.audioPlayer=n,this.lastEffect=i,this.value=this.DEFAULT_VALUE,this.initialized=!1,this.inputNode=null,this.outputNode=null,this.target=null}get name(){throw new Error(`${this.constructor.name}.name is not implemented`)}get DEFAULT_VALUE(){return 0}get _isPatch(){return this.initialized&&(this.value!==this.DEFAULT_VALUE||this.audioPlayer===null)}getInputNode(){return this._isPatch?this.inputNode:this.target.getInputNode()}initialize(){throw new Error(`${this.constructor.name}.initialize is not implemented.`)}_set(){throw new Error(`${this.constructor.name}._set is not implemented.`)}set(e){this.initialized||this.initialize();const n=this._isPatch;n&&(this._lastPatch=this.audioEngine.currentTime),this._set(e),this._isPatch!==n&&this.target!==null&&this.connect(this.target)}update(){}clear(){this.set(this.DEFAULT_VALUE)}connect(e){if(e===null)throw new Error("target may not be null");const n=i=>{if(i)return i===this?!0:n(i.target)};if(n(e))throw new Error("Effect cannot connect to itself");this.target=e,this.outputNode!==null&&this.outputNode.disconnect(),(this._isPatch||this._lastPatch+this.audioEngine.DECAY_DURATION<this.audioEngine.currentTime)&&this.outputNode.connect(e.getInputNode()),this.lastEffect===null?this.audioPlayer!==null&&this.audioPlayer.connect(this):this.lastEffect.connect(this)}dispose(){this.inputNode=null,this.outputNode=null,this.target=null,this.initialized=!1}}return X=u,X}var Z,Re;function Ie(){if(Re)return Z;Re=1;const u=ae();class r extends u{get DEFAULT_VALUE(){return 100}get name(){return"volume"}initialize(){this.inputNode=this.audioEngine.audioContext.createGain(),this.outputNode=this.inputNode,this.initialized=!0}_set(n){this.value=n;const{gain:i}=this.outputNode,{currentTime:t,DECAY_DURATION:s}=this.audioEngine;i.linearRampToValueAtTime(n/100,t+s)}dispose(){this.initialized&&(this.outputNode.disconnect(),this.inputNode=null,this.outputNode=null,this.target=null,this.initialized=!1)}}return Z=r,Z}var ee,qe;function ft(){if(qe)return ee;qe=1;const{EventEmitter:u}=ct(),r=Ie(),e="ended";class n extends u{constructor(t,{id:s,buffer:o}){super(),this.id=s,this.audioEngine=t,this.buffer=o,this.outputNode=null,this.volumeEffect=null,this.target=null,this.initialized=!1,this.isPlaying=!1,this.startingUntil=0,this.playbackRate=1,this.handleEvent=this.handleEvent.bind(this)}get isStarting(){return this.isPlaying&&this.startingUntil>this.audioEngine.currentTime}handleEvent(t){t.type===e&&this.onEnded()}onEnded(){this.emit("stop"),this.isPlaying=!1}_createSource(){this.outputNode!==null&&(this.outputNode.removeEventListener(e,this.handleEvent),this.outputNode.disconnect()),this.outputNode=this.audioEngine.audioContext.createBufferSource(),this.outputNode.playbackRate.value=this.playbackRate,this.outputNode.buffer=this.buffer,this.outputNode.addEventListener(e,this.handleEvent),this.target!==null&&this.connect(this.target)}initialize(){this.initialized=!0,this._createSource()}connect(t){if(t===this.volumeEffect){this.outputNode.disconnect(),this.outputNode.connect(this.volumeEffect.getInputNode());return}if(this.target=t,!!this.initialized)return this.volumeEffect===null?(this.outputNode.disconnect(),this.outputNode.connect(t.getInputNode())):this.volumeEffect.connect(t),this}dispose(){this.initialized&&(this.stopImmediately(),this.volumeEffect!==null&&(this.volumeEffect.dispose(),this.volumeEffect=null),this.outputNode.disconnect(),this.outputNode=null,this.target=null,this.initialized=!1)}take(){this.outputNode&&this.outputNode.removeEventListener(e,this.handleEvent);const t=new n(this.audioEngine,this);return t.playbackRate=this.playbackRate,this.isPlaying&&(t.startingUntil=this.startingUntil,t.isPlaying=this.isPlaying,t.initialized=this.initialized,t.outputNode=this.outputNode,t.outputNode.addEventListener(e,t.handleEvent),t.volumeEffect=this.volumeEffect,t.volumeEffect&&(t.volumeEffect.audioPlayer=t),this.target!==null&&t.connect(this.target),this.emit("stop"),t.emit("play")),this.outputNode=null,this.volumeEffect=null,this.initialized=!1,this.startingUntil=0,this.isPlaying=!1,t}play(){if(this.isStarting){this.emit("stop"),this.emit("play");return}this.isPlaying&&this.stop(),this.initialized?this._createSource():this.initialize(),this.outputNode.start(),this.isPlaying=!0;const{currentTime:t,DECAY_DURATION:s}=this.audioEngine;this.startingUntil=t+s,this.emit("play")}stop(){if(!this.isPlaying)return;const t=this.take();t.volumeEffect=new r(t.audioEngine,t,null),t.volumeEffect.connect(t.target),t.finished().then(()=>t.dispose()),t.volumeEffect.set(0);const{currentTime:s,DECAY_DURATION:o}=this.audioEngine;t.outputNode.stop(s+o)}stopImmediately(){this.isPlaying&&(this.outputNode.stop(),this.isPlaying=!1,this.startingUntil=0,this.emit("stop"))}finished(){return new Promise(t=>{this.once("stop",t)})}setPlaybackRate(t){this.playbackRate=t,this.initialized&&(this.outputNode.playbackRate.value=t)}}return ee=n,ee}var te,Me;function ht(){if(Me)return te;Me=1;class u{constructor(e,n){this.audioEngine=e,this.inputNode=this.audioEngine.audioContext.createGain(),this.effects=n;let i=null;this._effects=n.reverse().map(t=>{const s=new t(e,this,i);return this[s.name]=s,i=s,s}).reverse(),this.firstEffect=this._effects[0],this.lastEffect=this._effects[this._effects.length-1],this._soundPlayers=new Set}clone(){const e=new u(this.audioEngine,this.effects);return this.target&&e.connect(this.target),e}addSoundPlayer(e){this._soundPlayers.has(e)||(this._soundPlayers.add(e),this.update())}removeSoundPlayer(e){this._soundPlayers.remove(e)}getInputNode(){return this.inputNode}connect(e){const{firstEffect:n,lastEffect:i}=this;if(e===i){this.inputNode.disconnect(),this.inputNode.connect(i.getInputNode());return}else if(e===n)return;this.target=e,n.connect(e)}getSoundPlayers(){return[...this._soundPlayers]}setEffectsFromTarget(e){this._effects.forEach(n=>{"soundEffects"in e&&n.name in e.soundEffects?n.set(e.soundEffects[n.name]):n.name in e&&n.set(e[n.name])})}set(e,n){e in this&&this[e].set(n)}update(){this._effects.forEach(e=>e.update())}clear(){this._effects.forEach(e=>e.clear())}dispose(){this._soundPlayers=null,this._effects.forEach(e=>e.dispose()),this._effects=null}}return te=u,te}var ne,Oe;function lt(){if(Oe)return ne;Oe=1;const u=ae();class r extends u{constructor(n,i,t){super(n,i,t),this.leftGain=null,this.rightGain=null,this.channelMerger=null}get name(){return"pan"}initialize(){const n=this.audioEngine.audioContext;this.inputNode=n.createGain(),this.leftGain=n.createGain(),this.rightGain=n.createGain(),this.channelMerger=n.createChannelMerger(2),this.outputNode=this.channelMerger,this.inputNode.connect(this.leftGain),this.inputNode.connect(this.rightGain),this.leftGain.connect(this.channelMerger,0,0),this.rightGain.connect(this.channelMerger,0,1),this.initialized=!0}_set(n){this.value=n;const i=(n+100)/200,t=Math.cos(i*Math.PI/2),s=Math.sin(i*Math.PI/2),{currentTime:o,DECAY_WAIT:f,DECAY_DURATION:g}=this.audioEngine;this.leftGain.gain.setTargetAtTime(t,o+f,g),this.rightGain.gain.setTargetAtTime(s,o+f,g)}dispose(){this.initialized&&(this.inputNode.disconnect(),this.leftGain.disconnect(),this.rightGain.disconnect(),this.channelMerger.disconnect(),this.inputNode=null,this.leftGain=null,this.rightGain=null,this.channelMerger=null,this.outputNode=null,this.target=null,this.initialized=!1)}}return ne=r,ne}var ie,ke;function dt(){if(ke)return ie;ke=1;const u=ae();class r extends u{constructor(n,i,t){super(n,i,t),this.ratio=1}get name(){return"pitch"}get _isPatch(){return!1}getInputNode(){return this.target.getInputNode()}initialize(){this.initialized=!0}_set(n){this.value=n,this.ratio=this.getRatio(this.value),this.updatePlayers(this.audioPlayer.getSoundPlayers())}update(){this.updatePlayers(this.audioPlayer.getSoundPlayers())}getRatio(n){const i=n/10;return Math.pow(2,i/12)}updatePlayer(n){n.setPlaybackRate(this.ratio)}updatePlayers(n){if(n)for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&this.updatePlayer(n[i])}}return ie=r,ie}var re,Ue;function pt(){if(Ue)return re;Ue=1;const u=O(),r="*";class e{constructor(i,t){this.audioEngine=i,this.soundPlayers={},this.playerTargets=new Map,this.soundEffects=new Map,this.effectChainPrime=t}addSoundPlayer(i){this.soundPlayers[i.id]=i}getSoundPlayer(i){return this.soundPlayers[i]||u.error(`SoundBank.getSoundPlayer(${i}): called missing sound in bank`),this.soundPlayers[i]}getSoundEffects(i){return this.soundEffects.has(i)||this.soundEffects.set(i,this.effectChainPrime.clone()),this.soundEffects.get(i)}playSound(i,t){const s=this.getSoundEffects(t),o=this.getSoundPlayer(t);return this.playerTargets.get(t)!==i&&o.stop(),this.playerTargets.set(t,i),s.addSoundPlayer(o),s.setEffectsFromTarget(i),o.connect(s),o.play(),o.finished()}setEffects(i){this.playerTargets.forEach((t,s)=>{t===i&&this.getSoundEffects(s).setEffectsFromTarget(i)})}stop(i,t){this.playerTargets.get(t)===i&&this.soundPlayers[t].stop()}stopAllSounds(i=r){this.playerTargets.forEach((t,s)=>{(i===r||t===i)&&this.getSoundPlayer(s).stop()})}dispose(){this.playerTargets.clear(),this.soundEffects.forEach(i=>i.dispose()),this.soundEffects.clear();for(const i in this.soundPlayers)Object.prototype.hasOwnProperty.call(this.soundPlayers,i)&&this.soundPlayers[i].dispose();this.soundPlayers={}}}return re=e,re}var se,De;function gt(){if(De)return se;De=1;const u=We(),r=Qe(),e=O(),n=st(),i=at(),t=ut(),s=ft(),o=ht(),f=lt(),g=dt(),y=Ie(),d=pt(),E=function(_,m){return _.decodeAudioData.length===1?_.decodeAudioData(m):new Promise((S,L)=>{_.decodeAudioData(m,P=>S(P),P=>L(P))})};class b{constructor(m=new r){this.audioContext=m,u(this.audioContext),this.inputNode=this.audioContext.createGain(),this.inputNode.connect(this.audioContext.destination),this.audioBuffers={},this.loudness=null,this.effects=[f,g,y]}get currentTime(){return this.audioContext.currentTime}get EFFECT_NAMES(){return{pitch:"pitch",pan:"pan"}}get DECAY_DURATION(){return .025}get DECAY_WAIT(){return .05}getInputNode(){return this.inputNode}_decodeSound(m){const S=m.data.buffer.slice(0),L=n();return E(this.audioContext,S).catch(()=>{if(m.data.length===0)return this._emptySound();const A=m.data.buffer.slice(0);return new i(this.audioContext).decode(A).catch(()=>this._emptySound())}).then(A=>[L,A],A=>{e.warn("audio data could not be decoded",A)})}_emptySound(){return this.audioContext.createBuffer(1,1,this.audioContext.sampleRate)}decodeSound(m){return this._decodeSound(m).then(([S,L])=>(this.audioBuffers[S]=L,S))}decodeSoundPlayer(m){return this._decodeSound(m).then(([S,L])=>new s(this,{id:S,buffer:L}))}getLoudness(){return this.loudness||(this.loudness=new t(this.audioContext)),this.loudness.getLoudness()}createEffectChain(){const m=new o(this,this.effects);return m.connect(this),m}createBank(){return new d(this,this.createEffectChain())}}return se=b,se}var oe,Be;function vt(){return Be||(Be=1,oe=gt()),oe}var ze=vt();const mt=Ge(ze),Et=Ve({__proto__:null,default:mt},[ze]);export{Et as i};
